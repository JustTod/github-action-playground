name: Test switch case

on:
  push:
    branches:
      - develop
      - staging
      - main
  # pull_request:
  #   types:
  #     - closed

jobs:
  before_script:
    name: check branch
    runs-on: ubuntu-latest
    outputs:
      env_stage: ${{ steps.setup-output.outputs.stage }}
    steps:
    - name: Run switch-case-action
      uses: thaitype/actions-switch-case@v1
      id: switch_case
      with:
        default: none
        conditionals-with-values: |
          ${{ github.ref_name == 'main' }} => prod
          ${{ github.ref_name == 'staging' }} => stage
          ${{ github.ref_name == 'develop' }} => dev
    - name: setup output
      id: setup-output
      run: echo "stage=${{ steps.switch_case.outputs.match }}" >> "$GITHUB_OUTPUT"

  check_output:
    name: check output
    runs-on: ubuntu-latest
    needs: before_script
    env:
      STAGE: ${{ needs.before_script.outputs.env_stage }}
    # if: |
    #   ${{ github.event.pull_request.merged }} &&
    #   env.STAGE != "none"
    steps:
    - run: echo ${{ needs.before_script.outputs.env_stage }}
    - run: echo ${{ format('DEST1=dsk-test-$STAGE') }} >> "GITHUB_ENV"
    - run: echo ${{ format('DEST2=dsk-test-{0}', needs.before_script.outputs.env_stage ) }} >> "GITHUB_ENV"
    - name: check output 
      run: |
        echo $STAGE
        echo "$STAGE"
        echo "dsk-test-$STAGE"
        echo "$DEST1"
        echo "$DEST2"
